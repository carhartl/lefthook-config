---
commit-msg:
  commands:
    lint-commit-msg:
      run: npx --yes commitlint --config .commitlint.config.js --edit
pre-commit:
  parallel: true
  commands:
    golangci:
      tags: lint go
      glob: "*.go"
      # `golangci-lint run` requires all files to be in the same directory
      # when passing it named files, thus in order to only lint staged files
      # in the pre-commit hook linting them one by one...
      run: for file in {staged_files}; do golangci-lint run $file; done
    hadolint:
      tags: lint iac
      glob: "Dockerfile*"
      run: hadolint {staged_files} --failure-threshold warning
    prettier:
      tags: style glue
      glob: "*.{md,yaml,yml}"
      run: prettier --check {staged_files}
    shellcheck:
      tags: lint glue
      glob: "*.{bash,sh}"
      run: shellcheck {staged_files}
    shfmt:
      tags: style glue
      glob: "*.{bash,sh}"
      run: shfmt -d {staged_files}
    terraform:
      tags: style iac
      glob: "*.{tf,tfvars}"
      run: terraform fmt -check -diff {staged_files}
    tflint:
      tags: lint iac
      glob: "*.{tf,tfvars}"
      run: |
        for file in {staged_files}; do tflint "$file"; done
    yamllint:
      tags: lint glue
      glob: "*.{yaml,yml}"
      run: |
        yamllint -d "{extends: default, rules: {line-length: {max: 120}, comments: disable}}" {staged_files}
